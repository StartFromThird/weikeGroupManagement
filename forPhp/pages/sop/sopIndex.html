<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>SOPåˆ—è¡¨</title>
    <link rel="stylesheet" href="../../static/libs/element/element.css" />
    <link rel="stylesheet" href="../../static/style/base.css" />
    <script src="../../static/libs/vue.js"></script>
    <script src="../../static/libs/element/element.js"></script>
    <link rel="stylesheet" href="../../static/sop/sopIndex.css" />
    <!-- ä¸»é¢˜å¼•å…¥ -->
    <link rel="stylesheet" href="../../static/elementTheme/theme/index.css" />
  </head>
  <body>
    <div id="sopIndex"></div>
  </body>

  <script>
    const template = `<div class="sop-index-page main-content" style="height: 100vh;">
    <div class="search-wrap">
      <div class="search-items-wrap">
        <el-form size="mini" label-position="left" label-width="84px">
          <el-row :gutter="18">
            <el-col :sm="24" :md="12" :lg="12">
              <el-form-item label="åˆ›å»ºäººï¼š">
                <el-input
                  placeholder="è¯·é€‰æ‹©åˆ›å»ºäºº"
                  v-model="search.author"
                  clearable
                ></el-input>
              </el-form-item>
            </el-col>
            <el-col :sm="24" :md="12" :lg="12">
              <el-form-item label="æ‰€å±ç±»å‹ï¼š">
                <el-select
                  class="w100"
                  v-model="search.type"
                  placeholder="æ¶ˆæ¯ç±»å‹"
                  clearable
                >
                  <template v-for="(item, index) in typeOptions">
                    <el-option
                      :label="item"
                      value="shanghai"
                      :key="index + item"
                    ></el-option>
                  </template>
                </el-select>
              </el-form-item>
            </el-col>
            <el-col :sm="24" :md="12" :lg="12">
              <el-form-item label="åˆ›å»ºæ—¶é—´ï¼š">
                <el-date-picker
                  class="w100"
                  v-model="search.createdT"
                  type="datetimerange"
                  range-separator="è‡³"
                  start-placeholder="å¼€å§‹æ—¥æœŸ"
                  end-placeholder="ç»“æŸæ—¥æœŸ"
                ></el-date-picker>
              </el-form-item>
            </el-col>
            <el-col :sm="24" :md="12" :lg="12">
              <el-form-item label="å‘é€æ—¶é—´ï¼š">
                <el-date-picker
                  class="w100"
                  v-model="search.sentT"
                  type="datetimerange"
                  range-separator="è‡³"
                  start-placeholder="å¼€å§‹æ—¥æœŸ"
                  end-placeholder="ç»“æŸæ—¥æœŸ"
                ></el-date-picker>
              </el-form-item>
            </el-col>
            <el-col :sm="24" :md="12" :lg="12">
              <el-form-item label="SOPåç§°ï¼š">
                <el-input
                  placeholder="è¯·è¾“å…¥æœç´¢çš„SOPåç§°"
                  v-model="search.name"
                  clearable
                  maxlength="30"
                  show-word-limit
                ></el-input>
              </el-form-item>
            </el-col>
            <el-col :sm="15" :md="8" :lg="8">
              <el-form-item label="æ–‡æœ¬å†…å®¹ï¼š">
                <el-input
                  placeholder="è¯·è¾“å…¥æœç´¢çš„æ¶ˆæ¯å†…å®¹"
                  v-model="search.content"
                  clearable
                  maxlength="15"
                  show-word-limit
                ></el-input>
              </el-form-item>
            </el-col>
            <el-col :sm="8" :md="4" :lg="4">
              <el-form-item label="é™„ä»¶ç±»å‹ï¼š">
                <el-select
                  v-model="search.enclosure_type"
                  placeholder="è¯·é€‰æ‹©é™„ä»¶ç±»å‹"
                  clearable
                  style="min-width: 80px;"
                >
                  <template v-for="(item, index) in typeOptions">
                    <el-option
                      :label="item"
                      value="shanghai"
                      :key="index + item"
                    ></el-option>
                  </template>
                </el-select>
              </el-form-item>
            </el-col>
          </el-row>
        </el-form>
      </div>
      <div class="btns-wrap flex-r-betwween">
        <div class="left">
          <el-button type="success" size="mini" @click="handleAdd">
            + æ–°å»ºä¼ä¸šç¾¤å‘SOP
          </el-button>
          <el-popover
            placement="right"
            title="ç®€è¦è¯´æ˜ï¼"
            width="240"
            trigger="hover"
            content="åˆ›å»ºä¼ä¸šç¾¤å‘SOPï¼Œä¸šåŠ¡KPIå¯åˆ›å»ºå®éªŒç»„é€‰æ‹©åˆ›å»ºå¹¶é…ç½®å’Œå¯¹ç…§ç»„äº§ç”Ÿçš„æ•°æ®æ¯”å¯¹ï¼"
          >
            <div slot="reference" class="add-info">
              <img src="../../static/image/info.png" />
            </div>
          </el-popover>
        </div>
        <div class="right search-btns">
          <el-button size="mini">é‡ç½®</el-button>
          <el-button size="mini" type="primary">æŸ¥è¯¢</el-button>
        </div>
      </div>
    </div>
    <div class="table-wrap">
      <el-table
        height="calc(100% - 56px)"
        :data="tableData"
        style="width: 100%"
        :header-cell-style="{ background: '#F2F6FC' }"
        size="mini"
        border
        tooltip-effect="light"
      >
        <el-table-column
          prop="name"
          label="SOPåç§°"
          width="145"
          show-overflow-tooltip
        ></el-table-column>
        <el-table-column
          prop="author"
          label="åˆ›å»ºäºº"
          width="94"
          show-overflow-tooltip
        ></el-table-column>
        <el-table-column
          prop="typeN"
          label="æ‰€å±ç±»å‹"
          show-overflow-tooltip
        ></el-table-column>
        <el-table-column
          prop="createdT"
          label="åˆ›å»ºæ—¶é—´"
          show-overflow-tooltip
        ></el-table-column>
        <el-table-column
          prop="sentT"
          label="å‘é€æ—¶é—´"
          show-overflow-tooltip
        ></el-table-column>
        <el-table-column width="250" label="æ¶ˆæ¯å†…å®¹">
          <template slot-scope="scope">
            <div class="color-primary overflow-ellipsis" style="width: 209px;">
              {{scope.row.content}}
            </div>
          </template>
        </el-table-column>
        <el-table-column fixed="right" label="æ“ä½œ" width="100">
          <template slot-scope="scope">
            <el-button
              size="mini"
              type="text"
              @click="handleDetail(scope.$index, scope.row)"
              v-if="scope.row.isActive"
            >
              ç»“æœæŸ¥çœ‹
            </el-button>
            <template v-else>
              <el-button
                size="mini"
                type="text"
                @click="handleEdit(scope.$index, scope.row)"
              >
                ç¼–è¾‘
              </el-button>
              <el-button
                size="mini"
                type="text"
                class="color-warning"
                @click="handleDel(scope.$index, scope.row)"
              >
                åˆ é™¤
              </el-button>
            </template>
          </template>
        </el-table-column>
      </el-table>
      <div class="pagination-wrap">
        <el-pagination
          @size-change="handleSizeChange"
          @current-change="handleCurrentPageChange"
          :current-page="pageNo"
          :page-sizes="pageSizes"
          :page-size="pageSize"
          layout="total, sizes, prev, pager, next, jumper"
          :total="totalNo"
        ></el-pagination>
      </div>
    </div>
  </div>
    `;
    new Vue({
      template,
      el: "#sopIndex",
      name: "sopIndex",
      props: {},
      data() {
        return {
          search: {
            author: "",
            type: "",
            name: "",
            content: "",
          },
          info1:
            "ç®€è¦è¯´æ˜ï¼šåœ¨è¿™é‡Œåˆ›å»ºä¼ä¸šç¾¤å‘SOPï¼Œå¯è¿›è¡Œå¤šä¸ªä¸šåŠ¡KPIåˆ›å»ºé€‰æ‹©å¹¶é…ç½®ï¼Œå³å¯æŸ¥çœ‹è‡ªå®šä¹‰æŒ‡æ ‡äº§ç”Ÿçš„æ•°æ®æ¯”å¯¹",
          typeOptions: [
            "å…¨éƒ¨ä¼ä¸šç¾¤å‘æ¶ˆæ¯ç±»å‹",
            "ç¾¤å‘æ¶ˆæ¯ç»™å®¢æˆ·",
            "ç¾¤å‘æ¶ˆæ¯åˆ°ä¼ä¸šçš„å®¢æˆ·ç¾¤",
          ],
          tableData: [],
          pageSize: 10,
          pageNo: 1,
          pageSizes: [10, 15, 20],
          totalNo: 0,
          param: {},
        };
      },
      computed: {},
      created() {
        this.getTableData();
      },
      mounted() {},
      watch: {},
      methods: {
        handleDel(i, r) {
          this.$confirm("æ­¤æ“ä½œå°†æ°¸ä¹…åˆ é™¤è¯¥SOP, æ˜¯å¦ç»§ç»­?", "æç¤º", {
            confirmButtonText: "ç¡®å®š",
            cancelButtonText: "å–æ¶ˆ",
            type: "warning",
          })
            .then(() => {
              // è¯·æ±‚å›è°ƒé‡Œå†™
              this.$message({
                type: "success",
                message: "åˆ é™¤æˆåŠŸ!",
              });
              this.getTableData();
            })
            .catch(() => {
              this.$message({
                type: "info",
                message: "å·²å–æ¶ˆåˆ é™¤",
              });
            });
        },
        handleDetail(i, r) {
          // this.$router.push({
          //   path: "/sopEdit",
          //   query: {
          //     type: "detail",
          //     id: r.id,
          //   },
          // });
          location.href = `./sopEdit.html?type=detail&id=${r.id}`;
        },
        handleEdit(i, r) {
          // this.$router.push({
          //   path: "/sopEdit",
          //   query: {
          //     type: "edit",
          //     id: r.id,
          //   },
          // });
          location.href = `./sopEdit.html?type=edit&id=${r.id}`;
        },
        handleAdd() {
          // this.$router.push({
          //   path: "/sopEdit",
          //   query: {
          //     type: "add",
          //   },
          // });
          location.href = `./sopEdit.html?type=add`;
        },
        async getTableData() {
          let param = {
            pageSize: this.pageSize,
            pageNo: this.pageNo,
            ...this.search,
          };
          console.log("åˆ—è¡¨æŸ¥è¯¢å‚æ•°===", param);
          // await ...
          let tableData = [];
          // mock data start
          let tableDataItem = {
            name: "ä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹å",
            author: "ä¸€äºŒä¸‰å››äº”å…­",
            typeN: "ç¾¤å‘æ¶ˆæ¯ç»™å®¢æˆ·",
            createdT: "2021-05-20 13:20:13",
            sentT: "2021-05-20 13:20:13",
            content: "ã€å›¾ç‰‡ã€‘ã€è§†é¢‘ã€‘ã€å°ç¨‹åºã€‘ã€ç½‘é¡µã€‘1",
            // ğŸ˜€ğŸ˜
            isActive: false,
          };
          for (let i = 0; i < param.pageSize; i++) {
            let o = {
              ...tableDataItem,
              isActive: i % 2 === 0,
              id: `${param.pageNo}-${i}`,
            };
            tableData.push(JSON.parse(JSON.stringify(o)));
          }
          this.tableData = [...tableData];
          this.totalNo = 22;
          // mock data end
        },
        // é‡ç½®
        handleReset() {
          this.search = {};
          this.getTableData();
        },
        handleSizeChange(val) {
          this.pageSize = val;
          this.pageNo = 1;
          this.getTableData();
        },
        handleCurrentPageChange(val) {
          this.pageNo = val;
          this.getTableData();
        },
      },
    });
  </script>
</html>
